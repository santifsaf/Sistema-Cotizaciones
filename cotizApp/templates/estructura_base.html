{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CotizApp!</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'estructura_base.css' %}">


</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="{% url 'home' %}">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-briefcase me-2" viewBox="0 0 16 16">
          <path d="M6.5 1A1.5 1.5 0 0 0 5 2.5V3H1.5A1.5 1.5 0 0 0 0 4.5v8A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-8A1.5 1.5 0 0 0 14.5 3H11v-.5A1.5 1.5 0 0 0 9.5 1h-3zm0 1h3a.5.5 0 0 1 .5.5V3H6v-.5a.5.5 0 0 1 .5-.5zm1.886 6.914L15 7.151V12.5a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5V7.15l6.614 1.764a1.5 1.5 0 0 0 .772 0zM1.5 4h13a.5.5 0 0 1 .5.5v1.616L8.129 7.948a.5.5 0 0 1-.258 0L1 6.116V4.5a.5.5 0 0 1 .5-.5z"/>
        </svg>
        <span>CotizApp!</span>
      </a>
      
      {% if request.user.is_authenticated %}
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
              <!-- Cotizaciones -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="cotizacionesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Cotizaciones
                </a>
                <ul class="dropdown-menu" aria-labelledby="cotizacionesDropdown">
                  <li><a class="dropdown-item" href="{% url 'nueva_cotizacion' %}">Nueva cotización</a></li>
                  <li><a class="dropdown-item" href="{% url 'mis_cotizaciones' %}">Mis cotizaciones</a></li>
                </ul>
              </li>

              <!-- Artículos -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="articulosDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Artículos
                </a>
                <ul class="dropdown-menu" aria-labelledby="articulosDropdown">
                  <li><a class="dropdown-item" href="{% url 'nuevo_articulo' %}">Nuevo artículo</a></li>
                  <li><a class="dropdown-item" href="{% url 'mis_articulos' %}">Mis artículos</a></li>
                </ul>
              </li>

              <!-- Clientes -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="clientesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Clientes
                </a>
                <ul class="dropdown-menu" aria-labelledby="clientesDropdown">
                  <li><a class="dropdown-item" href="{% url 'nuevo_cliente' %}">Nuevo cliente</a></li>
                  <li><a class="dropdown-item" href="{% url 'mis_clientes' %}">Mis clientes</a></li>
                </ul>
              </li>
            </ul>
            
            <ul class="navbar-nav">

              <!-- Cuenta --> 
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="cuentaDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-person-circle me-2" viewBox="0 0 16 16">
                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                    <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                  </svg>
                  Cuenta
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="cuentaDropdown">
                  <li><a class="dropdown-item" href="{% url 'mis_empresas' %}">Datos empresa</a></li>
                  {% if request.user.is_authenticated %}
                  <li>
                    <form method="post" action="{% url 'logout' %}">
                      {% csrf_token %}
                      <button type="submit" class="dropdown-item">Cerrar sesión</button>
                    </form>
                  </li>
                  {% else %}
                  <li>
                    <a class="dropdown-item" href="{% url 'login' %}">Iniciar sesión</a>
                  </li>
                  {% endif %}
                </ul>
              </li>
              
              {% if request.user.is_authenticated and request.resolver_match.url_name == 'home' %}
              <li class="nav-item">
                <span class="welcome-text d-flex align-items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-hand-thumbs-up me-2" viewBox="0 0 16 16">
                    <path d="M8.864.046C7.908-.193 7.02.53 6.956 1.466c-.072 1.051-.23 2.016-.428 2.59-.125.36-.479 1.013-1.04 1.639-.557.623-1.282 1.178-2.131 1.41C2.685 7.288 2 7.87 2 8.72v4.001c0 .845.682 1.464 1.448 1.545 1.07.114 1.564.415 2.068.723l.048.03c.272.165.578.348.97.484.397.136.861.217 1.466.217h3.5c.937 0 1.599-.477 1.934-1.064a1.86 1.86 0 0 0 .254-.912c0-.152-.023-.312-.077-.464.201-.263.38-.578.488-.901.11-.33.172-.762.004-1.149.069-.13.12-.269.159-.403.077-.27.113-.568.113-.857 0-.288-.036-.585-.113-.856a2.144 2.144 0 0 0-.138-.362 1.9 1.9 0 0 0 .234-1.734c-.206-.592-.682-1.1-1.2-1.272-.847-.282-1.803-.276-2.516-.211a9.84 9.84 0 0 0-.443.05 9.365 9.365 0 0 0-.062-4.509A1.38 1.38 0 0 0 9.125.111L8.864.046zM11.5 14.721H8c-.51 0-.863-.069-1.14-.164-.281-.097-.506-.228-.776-.393l-.04-.024c-.555-.339-1.198-.731-2.49-.868-.333-.036-.554-.29-.554-.55V8.72c0-.254.226-.543.62-.65 1.095-.3 1.977-.996 2.614-1.708.635-.71 1.064-1.475 1.238-1.978.243-.7.407-1.768.482-2.85.025-.362.36-.594.667-.518l.262.066c.16.04.258.143.288.255a8.34 8.34 0 0 1-.145 4.725.5.5 0 0 0 .595.644l.003-.001.014-.003.058-.014a8.908 8.908 0 0 1 1.036-.157c.663-.06 1.457-.054 2.11.164.175.058.45.3.57.65.107.308.087.67-.266 1.022l-.353.353.353.354c.043.043.105.141.154.315.048.167.075.37.075.581 0 .212-.027.414-.075.582-.05.174-.111.272-.154.315l-.353.353.353.354c.047.047.109.177.005.488a2.224 2.224 0 0 1-.505.805l-.353.353.353.354c.006.005.041.05.041.17a.866.866 0 0 1-.121.416c-.165.288-.503.56-1.066.56z"/>
                  </svg>
                  {{ request.user.username }}, bienvenido!
                </span>
              </li>
              </li>
              {% endif %}
            </ul>
          </div>
        </div>
      {% endif %} 
          <div>
          <!-- Switch de Modo Oscuro -->
          <li class="nav-item">
            <button
              class="btn btn-outline-light btn-sm me-2"
              type="button"
              id="themeToggle"
              aria-label="Alternar tema oscuro"
              aria-pressed="false"
              data-bs-toggle="tooltip"
              data-bs-placement="bottom"
            >
              <!-- Íconos SVG sol y luna -->
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi d-none" id="lightIconSvg" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi" id="darkIconSvg" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
              </svg>
            </button>
      </div>
  </nav>

  <div id="html">
    {% block content %}
    {% endblock %}
  </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function(e) {
                    const submitBtn = form.querySelector('[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.innerText = submitBtn.dataset.loadingText || 'Procesando...';
                    }
                });
            });
        });
  </script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    // Tooltip boostrap init
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(el => new bootstrap.Tooltip(el));

    // Formularios: deshabilitar botón submit al enviar
    document.querySelectorAll('form').forEach(form => {
      form.addEventListener('submit', e => {
        const submitBtn = form.querySelector('[type="submit"]');
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.innerText = submitBtn.dataset.loadingText || 'Procesando...';
        }
      });
    });

    const themeToggle = document.getElementById('themeToggle');
    const htmlElement = document.documentElement;
    const lightIcon = document.getElementById('lightIconSvg');
    const darkIcon = document.getElementById('darkIconSvg');

    const savedTheme = localStorage.getItem('theme') || 'light';
    htmlElement.setAttribute('data-bs-theme', savedTheme);

    // Actualiza icono y aria-pressed
    function updateIcon(theme) {
      if (theme === 'dark') {
        lightIcon.classList.remove('d-none');
        darkIcon.classList.add('d-none');
        themeToggle.setAttribute('aria-pressed', 'true');
        themeToggle.setAttribute('title', 'Cambiar a modo claro');
      } else {
        lightIcon.classList.add('d-none');
        darkIcon.classList.remove('d-none');
        themeToggle.setAttribute('aria-pressed', 'false');
        themeToggle.setAttribute('title', 'Cambiar a modo oscuro');
      }
    }

    updateIcon(savedTheme);

    themeToggle.addEventListener('click', () => {
      const currentTheme = htmlElement.getAttribute('data-bs-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

      htmlElement.setAttribute('data-bs-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateIcon(newTheme);
    });
  });
  </script>
</body>
</html>